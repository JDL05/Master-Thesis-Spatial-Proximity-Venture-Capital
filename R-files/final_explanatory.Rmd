---
title: "Explanatory Data Analysis Overleaf"
author: "Jan Linzner"
date: "2025-05-21"
output: html_document
knit:
  root.dir: "~/Projects/Master-Thesis-Spatial-Proximity-Venture-Capital"
---

# File Prep
```{r Load Packages and Data Sets}
library(readr)
library(xtable)
library(tidyverse)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(scales)
library(tibble)
library(knitr)
library(kableExtra)

setwd("~/Projects/Master-Thesis-Spatial-Proximity-Venture-Capital")
companies_seed <- read_csv("data/sets-for-r/companies_seed.csv")
investors_seed <- read_csv("data/sets-for-r/investors_seed.csv")
hubs <- read_csv("data/sets-for-r/startup_hubs.csv")
seed_help <- read_csv("data/sets-for-r/seed_help.csv")
rounds <- read_csv("data/sets-for-r/rounds.csv")
```

```{r setup, include=FALSE}
knitr::opts_knit$set(
  root.dir = "~/Projects/Master-Thesis-Spatial-Proximity-Venture-Capital"
)
```


# Tables
## Companies - Overall

```{r Companies Seed Summary}
make_summary <- function(data, group_name) {
  data %>%
    summarise(
      Country                   = group_name,
      n                         = n(),
      Avg_Seed_Rounds           = mean(`Number Seed Rounds`,        na.rm = TRUE),
      Avg_Seed_Investors        = mean(`Number Seed Investors`,     na.rm = TRUE),
      Avg_Seed_Lead_Investors   = mean(`Number Lead Seed Investors`, na.rm = TRUE),
      Avg_Seed_Investor_Dist_km = mean(`Avg Seed Investor Distance`, na.rm = TRUE),
      Pct_in_Hubs               = mean(`Hub Binary`,                 na.rm = TRUE) * 100,
      Avg_Hub_Dist_km           = mean(`Distance to Hub`,           na.rm = TRUE),
      Avg_Num_Founders          = mean(`Number of Founders`[`Number of Founders` > 0],
                                        na.rm = TRUE),
      Avg_Years_to_Seed         = mean(`Years to Seed`,              na.rm = TRUE),
      Pct_Success               = mean(`Success`,                    na.rm = TRUE) * 100
    )
}

by_country <- companies_seed %>%
  group_by(`Headquarters Country`) %>%
  group_map(~ make_summary(.x, .y$`Headquarters Country`), .keep = TRUE) %>%
  bind_rows()

europe_summary <- make_summary(companies_seed, "Europe")

summary_tbl <- bind_rows(by_country, europe_summary) %>%
  arrange(Country)

hubs_count   <- hubs %>%
  count(country) %>%
  rename(Country = country, `Number of Hubs` = n)
europe_hubs  <- nrow(hubs)

summary_tbl <- summary_tbl %>%
  left_join(hubs_count, by = "Country") %>%
  mutate(`Number of Hubs` = replace_na(`Number of Hubs`, 0))

summary_tbl <- summary_tbl %>%
  rename(
    N                         = n,
    `Avg Seed Rounds`         = Avg_Seed_Rounds,
    `Avg Seed VC`      = Avg_Seed_Investors,
    `Avg Lead Seed VC` = Avg_Seed_Lead_Investors,
    `Avg VC Dist. (km)`       = Avg_Seed_Investor_Dist_km,
    `Avg # Founders`          = Avg_Num_Founders,
    `Avg Years to Seed`       = Avg_Years_to_Seed,
    `% Success`               = Pct_Success
  )

formatted <- summary_tbl %>%
  select(
    Country, N,
    `Avg Seed Rounds`, `Avg Seed VC`, `Avg Lead Seed VC`,
    `Avg Years to Seed`, `Avg # Founders`,
    `Avg VC Dist. (km)`, `% Success`
  ) %>%
  mutate(across(where(is.numeric), ~ sprintf("%.2f", .))) %>%
  mutate(across(c(N), as.character))

others_tbl <- formatted %>% filter(Country != "Europe")
europe_tbl <- formatted %>% filter(Country == "Europe")

europe_bold <- europe_tbl %>%
  mutate(across(everything(), ~ paste0("\\textbf{", ., "}")))

final_tbl_clean <- bind_rows(others_tbl, europe_bold)

print(
  xtable(
    final_tbl_clean,
    label   = "tab:seed_summary_clean",
    digits  = rep(0, ncol(final_tbl_clean) + 1)
  ),
  type                       = "latex",
  include.rownames           = FALSE,
  booktabs                   = TRUE,
  sanitize.text.function     = identity,
  sanitize.colnames.function = function(x) {
    x %>% gsub("%","\\\\%",.) %>% gsub("#","\\\\#",.)
  },
  file                       = "R-files/tables/table_companies-general_europe.tex"
)

print(final_tbl_clean, width = Inf)
```
## Companies - Hubs
```{r Companies - Hub Summary, message=FALSE, warning=FALSE}
company_counts <- companies_seed |>
  count(`Headquarters Country`, name = "N")

hub_success_stats <- companies_seed |>
  filter(`Hub Binary` == 1) |>
  group_by(`Headquarters Country`) |>
  summarise(
    `N Startups in Hubs`  = n(),
    `N Success in Hubs`   = sum(Success, na.rm = TRUE),
    .groups = "drop"
  )

total_success_stats <- companies_seed |>
  group_by(`Headquarters Country`) |>
  summarise(`N Success Cases` = sum(Success, na.rm = TRUE), .groups = "drop")

hub_share_stats <- companies_seed |>
  group_by(`Headquarters Country`) |>
  summarise(
    `% Startups in Hubs` = mean(`Hub Binary`, na.rm = TRUE) * 100,
    `Avg Hub Dist. (km)` = mean(`Distance to Hub`, na.rm = TRUE),
    .groups = "drop"
  )

hubs_count <- hubs |>
  count(country, name = "Number of Hubs") |>
  rename(Country = country)

hub_summary <- hubs_count |>
  full_join(company_counts,      by = c("Country" = "Headquarters Country")) |>
  full_join(hub_success_stats,   by = c("Country" = "Headquarters Country")) |>
  full_join(total_success_stats, by = c("Country" = "Headquarters Country")) |>
  full_join(hub_share_stats,     by = c("Country" = "Headquarters Country")) |>
  mutate(

    `% Success in Hubs`        = (`N Success in Hubs` / `N Success Cases`) * 100,
    
    `Success Rate (All)`        = (`N Success Cases`   / N)                    * 100,
    `Success Rate in Hubs`      = (`N Success in Hubs` / `N Startups in Hubs`) * 100,
    `Success Rate outside Hubs` = ((`N Success Cases` - `N Success in Hubs`) /
                                   pmax(N - `N Startups in Hubs`, 1)) * 100
  )

all_countries <- companies_seed |>
  distinct(`Headquarters Country`) |>
  rename(Country = `Headquarters Country`)

hub_tbl_full <- all_countries |>
  left_join(hub_summary, by = "Country")

fmt_pct <- function(x) {
  ifelse(is.na(x) | x == 0, "–", sprintf('%.2f', x))
}

pretty_tbl <- hub_tbl_full |>
  mutate(
    across(
      c(N, `Number of Hubs`, `N Startups in Hubs`,
        `N Success Cases`, `N Success in Hubs`),
      \(x) ifelse(is.na(x), "–", as.character(x))
    ),
    across(
      c(`% Startups in Hubs`, `Avg Hub Dist. (km)`,
        `Success Rate (All)`, `Success Rate in Hubs`,
        `Success Rate outside Hubs`, `% Success in Hubs`),
      fmt_pct
    )
  )

eu_N             <- nrow(companies_seed)

eu_hub_N         <- sum(companies_seed$`Hub Binary`,                       na.rm = TRUE)
eu_success_N     <- sum(companies_seed$Success,                            na.rm = TRUE)
eu_hub_success_N <- sum(companies_seed$Success * companies_seed$`Hub Binary`,
                        na.rm = TRUE)

eu_row <- tibble(
  Country              = "\\textbf{Europe}",
  N                    = paste0("\\textbf{", eu_N, "}"),
  `Number of Hubs`     = paste0("\\textbf{", nrow(hubs), "}"),
  `% Startups in Hubs` = paste0("\\textbf{", fmt_pct(eu_hub_N / eu_N * 100), "}"),
  `N Startups in Hubs` = paste0("\\textbf{", eu_hub_N, "}"),
  `Avg Hub Dist. (km)` = paste0("\\textbf{", fmt_pct(
                                   mean(companies_seed$`Distance to Hub`, na.rm = TRUE)
                                 ), "}"),
  `N Success Cases`          = paste0("\\textbf{", eu_success_N, "}"),
  `Success Rate (All)`       = paste0("\\textbf{", fmt_pct(eu_success_N / eu_N * 100), "}"),
  `N Success in Hubs`        = paste0("\\textbf{", eu_hub_success_N, "}"),
  `% Success in Hubs`        = paste0("\\textbf{", fmt_pct(eu_hub_success_N / eu_success_N * 100), "}"),
  `Success Rate in Hubs`     = paste0("\\textbf{", fmt_pct(eu_hub_success_N / eu_hub_N * 100), "}"),
  `Success Rate outside Hubs`= paste0("\\textbf{", fmt_pct(
                                         (eu_success_N - eu_hub_success_N) /
                                         (eu_N - eu_hub_N) * 100
                                       ), "}")
)

hub_tbl_final <- bind_rows(pretty_tbl, eu_row) |>
  arrange(Country) |>
  select(
    Country,
    N, `Number of Hubs`,
    `N Startups in Hubs`, `% Startups in Hubs`, `Avg Hub Dist. (km)`,
    `N Success Cases`, `N Success in Hubs`,
    `Success Rate (All)`, `Success Rate in Hubs`,
    `Success Rate outside Hubs`, `% Success in Hubs`
  )

print(
  xtable(
    hub_tbl_final,
    caption = "Hub structure and success by country",
    label   = "tab:hub_summary",
    digits  = rep(0, ncol(hub_tbl_final) + 1)
  ),
  type         = "latex",
  file         = "R-files/tables/table_hub-europe.tex",
  include.rownames = FALSE,
  booktabs     = TRUE,
  floating     = FALSE,
  sanitize.text.function = identity,
  sanitize.colnames.function = \(x) gsub("%", "\\\\%", gsub("#", "\\\\#", x))
)

hub_tbl_final  
```
## Companies - Seed Funding by Country/Investor
```{r Seed-Investor Summary, message=FALSE, warning=FALSE}
fmt2 <- function(x){
  ifelse(is.na(x),
         "–",
         sub("\\.?0+$", "", sprintf("%.2f", round(x, 2))))
}

investor_tbl <- companies_seed %>% 
  group_by(Country = `Headquarters Country`) %>% 
  summarise(
    N                          = n(),
    `N Regional`               = sum(`Regional Seed Investor Binary`,        na.rm = TRUE),
    `N Overregional`           = sum(`Overregional Seed Investor Binary`,    na.rm = TRUE),
    `N Specific VC`            = sum(`Specific VC in Seed Binary`,  na.rm = TRUE),
    `N Accelerator`            = sum(`Accelerator Funding Binary`,           na.rm = TRUE),
    `N CVC`                    = sum(`Corporate Venture Capital Funding Binary`, na.rm = TRUE),
    `N Target`                    = sum(`Target VC in Seed Binary`, na.rm = TRUE),
    .groups = "drop"
  ) %>% 
  mutate(
    `% Regional`             = `N Regional`             / N * 100,
    `% Overregional`         = `N Overregional`         / N * 100,
    `% Specific VC`          = `N Specific VC` / N * 100,
    `% Accelerator`          = `N Accelerator`          / N * 100,
    `% CVC`                  = `N CVC`                  / N * 100,
        `% Target`                  = `N Target`                  / N * 100,
  )

investor_tbl_fmt <- investor_tbl %>% 
  arrange(Country) %>% 
  mutate(
    across(starts_with("N"), as.character),
    across(starts_with("%"), fmt2)
  )

eu_row <- investor_tbl %>%                              
  summarise(
    Country                    = "\\textbf{Europe}",
    N                          = sum(N),
    `N Regional`               = sum(`N Regional`),
    `N Overregional`           = sum(`N Overregional`),
    `N Specific VC`            = sum(`N Specific VC`),
    `N Accelerator`            = sum(`N Accelerator`),
    `N CVC`                    = sum(`N CVC`),
      `N Target`                    = sum(`N Target`)
  ) %>% 
  mutate(
    `% Regional`             = `N Regional`             / N * 100,
    `% Overregional`         = `N Overregional`         / N * 100,
    `% Specific VC` = `N Specific VC` / N * 100,
    `% Accelerator`          = `N Accelerator`          / N * 100,
    `% CVC`                  = `N CVC`                  / N * 100,
        `% Target`                  = `N Target`                  / N * 100
  ) %>% 
  mutate(
    across(starts_with("N"), as.character),
    across(starts_with("%"), fmt2),
    across(everything(), \(x) paste0("\\textbf{", x, "}"))
  )

final_tbl <- bind_rows(investor_tbl_fmt, eu_row) %>% 
  select(
    Country, N,
    `N Regional`, `% Regional`,
    `N Overregional`, `% Overregional`,
    `N Specific VC`, `% Specific VC`,
    `N Accelerator`, `% Accelerator`,
    `N CVC`, `% CVC`,
    `N Target`, `% Target`,
  )

print(
  xtable(
    final_tbl,
    caption = "Seed-stage companies by investor type and country",
    label   = "tab:seed_investor_summary",
    digits  = 0           # all strings already formatted
  ),
  include.rownames           = FALSE,
  booktabs                   = TRUE,
  floating                   = FALSE,
  sanitize.text.function     = identity,
  sanitize.colnames.function = \(x) gsub("%", "\\\\%", x),
  file                       = "R-files/tables/table_seed_investor-europe.tex"
)

final_tbl      
```

## Investors - General

```{r Investors Classes Investment Behaviour}
deals <- seed_help %>%
  semi_join(companies_seed, by = "Company ID") %>%                  
  inner_join(investors_seed %>% select(`Investor ID`),               
             by = "Investor ID") %>%
  distinct(`Round ID`, `Investor ID`, .keep_all = TRUE) %>%         
  left_join(companies_seed %>% select(`Company ID`, Success),
            by = "Company ID")                                      

companies_seed <- companies_seed %>%
  semi_join(deals %>% distinct(`Company ID`), by = "Company ID")

tot_inv   <- deals %>% pull(`Investor ID`)   %>% n_distinct()
tot_deals <- nrow(deals)
tot_comp  <- deals %>% pull(`Company ID`)    %>% n_distinct()
tot_succ  <- sum(deals$Success, na.rm = TRUE)

inv_flags <- investors_seed %>%
  select(`Investor ID`,
         `Local Investor`,
         `Specific VC Binary`,
         `Accelerator`,
         `Corporate Venture Capital`,
         `Micro VC`,
         `Target VC`,
         `Hub Investor`,
         `Lead Investor`) %>%
  mutate(across(-`Investor ID`, ~ replace_na(.x, FALSE))) %>%
  semi_join(deals, by = "Investor ID")  

cats <- c(
  "Investors"                 = NA,
  "Local Investor"            =  "Local Investor",
  "Overregional Investor"     = "!Local Investor",
  "Specific VC"               =  "Specific VC Binary",
  "Non-specific VC"           = "!Specific VC Binary",
  "Accelerator"               =  "Accelerator",
  "Corporate Venture Capital" =  "Corporate Venture Capital",
  "Micro VC"                  =  "Micro VC",
  "Hub Investor"              =  "Hub Investor",
  "Non-Hub Investor"          = "!Hub Investor",
  "Target VC"                 = "Target VC",
  "Non-Target VC"             = "!Target VC",
  "Lead Investor"             =  "Lead Investor",
  "Co-Investor"               = "!Lead Investor"
)

make_row <- function(flag, label) {
  if (is.na(flag)) {
    n_inv <- tot_inv;  nd <- tot_deals;  nc <- tot_comp;  ns <- tot_succ
  } else {
    neg <- startsWith(flag, "!")
    col <- sub("^!", "", flag)
    ids <- inv_flags %>%
      filter(if (neg) !.data[[col]] else .data[[col]]) %>%
      pull(`Investor ID`)
    df <- deals %>% filter(`Investor ID` %in% ids)
    n_inv <- length(ids)
    nd    <- nrow(df)
    nc    <- n_distinct(df$`Company ID`)
    ns    <- sum(df$Success, na.rm = TRUE)
  }
  tibble(
    Category         = label,
    N                = n_inv,
    `% of Investors` = n_inv   / tot_inv   * 100,
    `# Investments`  = nd,
    `% Investments`  = nd      / tot_deals * 100,
    `# Companies`    = nc,
    `% Companies`    = nc      / tot_comp  * 100,
    `# Successes`    = ns,
    `% Successes`    = if (tot_succ==0) NA else ns / tot_succ * 100,
    `Success Rate`   = if (nc      ==0) NA else ns / nc      * 100
  )
}

fmt2 <- function(x) ifelse(is.na(x) | x==0,
                           "–",
                           sub("\\.?0+$","",sprintf("%.2f",round(x,2))))
final_tbl <- imap_dfr(cats, make_row) %>%
  mutate(across(-Category, fmt2))

print(
  xtable(
    final_tbl,
    caption = "Seed-stage companies by investor type (companies_seed sample)",
    label   = "tab:seed_investor_summary",
    digits  = 0
  ),
  include.rownames       = FALSE,
  booktabs               = TRUE,
  floating               = FALSE,
  sanitize.text.function = identity,
  sanitize.colnames.function = \(x) gsub("%","\\\\%", x),
  file                   = "R-files/tables/table_investor_classification.tex"
)

print(final_tbl, width = Inf)
```

## Funding - by Company Founding Year
```{r Funding by Year}
funding_per_company <- rounds %>%
  filter(!is.na(`Money Raised (in USD)`), `Money Raised (in USD)` > 0) %>%
  inner_join(
    companies_seed %>% select(`Organization Name URL`, `Company ID`, `Founded Year`),
    by = "Organization Name URL"
  ) %>%
  group_by(`Company ID`, Founded_Year = `Founded Year`) %>%
  summarise(
    n_rounds      = n(),
    total_funding = sum(`Money Raised (in USD)`, na.rm = TRUE),
    .groups       = "drop"
  ) %>%
  filter(total_funding > 0)

cohort_stats <- funding_per_company %>%
  group_by(Founded_Year) %>%
  summarise(
    N                   = n_distinct(`Company ID`),
    Avg_Funding_Rounds  = mean(n_rounds,        na.rm = TRUE),
    Mean_Funding        = mean(total_funding,   na.rm = TRUE),
    SD_Funding          = sd(total_funding,     na.rm = TRUE),
    Max_Funding         = max(total_funding,    na.rm = TRUE),
    Min_Funding         = min(total_funding,    na.rm = TRUE),
    .groups            = "drop"
  ) %>%
  mutate(Founded_Year = as.character(Founded_Year))

overall_stats <- funding_per_company %>%
  summarise(
    Founded_Year        = "Overall",
    N                   = n_distinct(`Company ID`),
    Avg_Funding_Rounds  = mean(n_rounds,        na.rm = TRUE),
    Mean_Funding        = mean(total_funding,   na.rm = TRUE),
    SD_Funding          = sd(total_funding,     na.rm = TRUE),
    Max_Funding         = max(total_funding,    na.rm = TRUE),
    Min_Funding         = min(total_funding,    na.rm = TRUE)
  )

funding_summary <- bind_rows(cohort_stats, overall_stats) %>%
  mutate(
    across(
      c(Mean_Funding, SD_Funding, Max_Funding, Min_Funding),
      ~ round(.x / 1e6, 2)
    ),
    Founded_Year = factor(
      Founded_Year,
      levels = c(sort(unique(cohort_stats$Founded_Year)), "Overall")
    )
  ) %>%
  arrange(Founded_Year)

funding_tbl_fmt <- funding_summary %>%
  rename(
    `Founding Year`    = Founded_Year,
    `# Companies (N)`  = N,
    `Avg # Rounds`     = Avg_Funding_Rounds,
    `Mean Funding (M)` = Mean_Funding,
    `SD Funding (M)`   = SD_Funding,
    `Max Funding (M)`  = Max_Funding,
    `Min Funding (M)`  = Min_Funding
  ) %>%
  mutate(across(-`Founding Year`, ~ sprintf("%.2f", as.numeric(.))))

print(
  xtable(
    funding_tbl_fmt,
    caption = "Lifetime Seed Funding by Founding Cohort",
    label   = "tab:funding_by_founding_year",
    align   = c("l","c", rep("S[table-format=4.2]", ncol(funding_tbl_fmt)-1)),
    digits  = 0
  ),
  file                   = "R-files/tables/table_funding-by-year.tex",
  include.rownames       = FALSE,
  booktabs               = TRUE,
  floating               = FALSE,
  sanitize.text.function = identity,
  sanitize.colnames.function = identity
)

print(funding_tbl_fmt, n = Inf)
```

# Visualizations
## Companies
### Success by Year
```{r Success by Year}
warm_cols <- c("No Success" = "#E69F00", "Success" = "#D55E00")
shared_theme <- theme_minimal(base_size = 14) +
  theme(
    plot.title         = element_text(face = "bold", size = 16, hjust = 0.5),
    axis.title         = element_text(size = 13),
    axis.text.x        = element_text(size = 8),
    axis.text.y        = element_text(size = 8),
    legend.position    = "top",
    legend.title       = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.minor   = element_blank(),
    plot.margin        = margin(10, 20, 10, 10)
  )

yearly_counts_cs <- companies_seed %>%
  mutate(
    Year   = year(`Founded Date`),
    Status = if_else(Success, "Success", "No Success")
  ) %>%
  group_by(Year, Status) %>%
  summarise(
    Companies = n(),       
    .groups   = "drop"
  ) %>%
  complete(Year, Status, fill = list(Companies = 0)) %>%
  mutate(Status = factor(Status, levels = c("No Success", "Success")))

ggplot(yearly_counts_cs, aes(x = factor(Year), y = Companies, fill = Status)) +
  geom_col(width = 0.7) +
  scale_fill_manual(values = warm_cols) +
  scale_y_continuous(expand = expansion(mult = c(0, .05))) +
  labs(
    title = "Seed-stage Companies by Year and Outcome",
    x     = "Year Founded",
    y     = "Number of Companies",
    fill  = NULL
  ) +
  shared_theme
```

## Investors
### Success by Investor Class
```{r Success by Investor Type}
plot_tbl <- final_tbl %>%
  mutate(
    pct_companies = as.numeric(`% Companies`),
    pct_success   = as.numeric(`% Successes`),
    success_rate  = as.numeric(`Success Rate`)
  )

warm_cols <- c("Companies" = "#E69F00", "Successes" = "#D55E00")
point_col <- "#CC3311"

shared_theme <- theme_minimal(base_size = 14) +
  theme(
    plot.title         = element_text(face = "bold", size = 16, hjust = 0.5),
    axis.title         = element_text(size = 13),
    axis.text.x        = element_text(size = 8),    
    axis.text.y        = element_text(size = 8),    
    legend.position    = "top",
    legend.title       = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.minor   = element_blank(),
    plot.margin        = margin(10, 20, 10, 10)
  )


stacked_data <- plot_tbl %>%
  rowwise() %>%
  mutate(
    tot        = pct_companies + pct_success,
    comp_share = pct_companies / tot * 100,
    succ_share = pct_success  / tot * 100
  ) %>%
  ungroup() %>%
  select(Category, comp_share, succ_share) %>%
  pivot_longer(
    cols      = c(comp_share, succ_share),
    names_to  = "segment",
    values_to = "pct"
  ) %>%
  mutate(
    segment  = recode(segment,
                      comp_share = "Companies",
                      succ_share = "Successes"),
    Category = fct_reorder(Category, pct, .fun = max)
  )

# ── Plot 1: 100% Stacked Bar ────────────────────────────────────────────────
ggplot(stacked_data, aes(x = Category, y = pct, fill = segment)) +
  geom_col(width = 0.7) +
  coord_flip() +
  scale_y_continuous(
    labels = percent_format(scale = 1),
    expand = expansion(mult = c(0, .10))  
  ) +
  scale_fill_manual(values = warm_cols) +
  labs(
    title = "Portfolio Composition: Companies vs Success",
    x     = NULL,
    y     = "Share within type (100%)"
  ) +
  shared_theme

# ── Plot 2: Horizontal Lollipop ────────────────────────────────────────────
ggplot(plot_tbl %>% arrange(success_rate),
       aes(x = success_rate,
           y = fct_reorder(Category, success_rate))) +
  geom_segment(aes(x = 0, xend = success_rate, y = Category, yend = Category),
               color = "gray80", size = 0.5) +
  geom_point(color = point_col, size = 4) +
  scale_x_continuous(
    labels = function(x) sprintf("%.0f%%", x),
    expand = expansion(mult = c(0, .10))   
  ) +
  labs(
    title = "Success Rate by Investor Type",
    x     = "Success Rate (%)",
    y     = NULL
  ) +
  shared_theme
```
# Description
## Company Variable

```{r Company Variable Description Table}
vars <- tribble(
  ~group,                     ~var,                                    ~desc,

  "Outcome Variable",        "Success",                               "1 if company exited (IPO or acquisition) or raised more than 20,000,000 USD of Equity Funding.",
  "Outcome Variable", "Exit", "1 if company is flagged as an Exit Case.",
  "Outcome Variable", "Funding Success", "1 if company raised more than 20,000,000 USD of Equity Funding",

  # Fundamental variables ---> pre-existing, no treatment effect
  "Fundamental Variables",   "Headquarters Country",                  "Country where the company is headquartered.",
  "Fundamental Variables",   "Founding Year",                         "Year when the company was founded.",
  "Fundamental Variables",   "Number of Founders",                    "Total count of the founding team.",
  "Fundamental Variables",   "Distance to Hub",                       "Distance (km) from HQ to nearest startup hub.",
  "Fundamental Variables",   "Hub Binary",                            "1 if HQ is in a startup hub; else 0.",
  "Fundamental Variables",   "B2B Binary",                            "1 if startup is focussing business customers; else 0.",

  # --- here come the 11 GICS‐head sectors + Other
  "Fundamental Variables",   "Energy",                                "1 if classified in the GICS Energy sector; else 0.",
  "Fundamental Variables",   "Materials",                             "1 if classified in the GICS Materials sector; else 0.",
  "Fundamental Variables",   "Industrials",                           "1 if classified in the GICS Industrials sector; else 0.",
  "Fundamental Variables",   "Consumer Discretionary",                "1 if classified in the GICS Consumer Discretionary sector; else 0.",
  "Fundamental Variables",   "Consumer Staples",                      "1 if classified in the GICS Consumer Staples sector; else 0.",
  "Fundamental Variables",   "Health Care",                           "1 if classified in the GICS Health Care sector; else 0.",
  "Fundamental Variables",   "Financials",                            "1 if classified in the GICS Financials sector; else 0.",
  "Fundamental Variables",   "Information Technology",                "1 if classified in the GICS Information Technology sector; else 0.",
  "Fundamental Variables",   "Communication Services",                "1 if classified in the GICS Communication Services sector; else 0.",
  "Fundamental Variables",   "Utilities",                             "1 if classified in the GICS Utilities sector; else 0.",
  "Fundamental Variables",   "Real Estate",                           "1 if classified in the GICS Real Estate sector; else 0.",
  "Fundamental Variables",   "Other",                                 "1 if classified outside the 11 GICS sectors; else 0.",

  # Treatment (investor & funding) variables ---> treatment
  "Treatment Variables",  "Number Seed Rounds",                    "Total number of seed funding rounds completed.",
  "Treatment Variables",  "Avg Seed VC Distance",                  "Mean distance (km) between seed investors and HQ.",
  "Treatment Variables",  "Avg Seed VC Portfolio Organizations",    "Average portfolio size of seed investors.",
  "Treatment Variables",  "Avg Age Seed VC",                       "Mean years of experience among seed investors.",
  "Treatment Variables",  "Avg Exits Seed VC",                     "Mean number of prior successful exits per seed investor.",
  "Treatment Variables",  "Number Seed VC",                        "Count of distinct investors in seed rounds.",
  "Treatment Variables", "Seed VC Same City Binary", "1 if a Seed VC is in the same city as the startup.",
  "Treatment Variables", "Homecountry VC in Seed Binary", "1 if a VC is in the same homecountry as the startup.",
  "Treatment Variables",  "Regional Seed VC Binary",               "1 if at least one seed investor is local (<100 km); else 0.",
  "Treatment Variables",  "Overregional Seed VC Binary",           "1 if any seed investor is from outside the region; else 0.",
  "Treatment Variables",  "Specific VC in Seed Binary",            "1 if a topic-focused VC participated in seed; else 0.",
  "Treatment Variables",  "Accelerator in Seed Binary",            "1 if an accelerator participated in seed; else 0.",
  "Treatment Variables",  "Angel Group in Seed Binary",            "1 if an angel group participated in seed; else 0.",
  "Treatment Variables",  "Micro VC in Seed Binary",               "1 if a micro-VC fund participated in seed; else 0.",
  "Treatment Variables",  "Corporate VC in Seed Binary",           "1 if a corporate venture arm invested in seed; else 0.",
  "Treatment Variables",  "Target VC in Seed Binary",               "1 if a target VC invested in seed, else 0.",
  "Treatment Variables",  "Number Lead Seed VC",                   "Count of investors who led any seed round.",
  "Treatment Variables", "Seed Lead VC Same City Binary", "1 if a Lead Seed VC is in the same city as the startup",
  "Treatment Variables", "Homecountry Lead VC in Seed Binary", "1 if a lead VC is in the same homecountry as the startup.",
  "Treatment Variables",  "Regional Lead VC in Seed Binary",       "1 if a local investor led the seed round; else 0.",
  "Treatment Variables",  "Overregional Lead VC in Seed Binary",    "1 if a non-local investor led the seed round; else 0.",
  "Treatment Variables",  "Specific Lead VC in Lead Seed Binary",   "1 if a named topic-focused VC firm led the seed round; else 0.",
  "Treatment Variables",  "Accelerator Lead in Seed Binary",        "1 if an accelerator led the seed round; else 0.",
  "Treatment Variables",  "Angel Group Lead in Seed Binary",        "1 if an angel group led the seed round; else 0.",
  "Treatment Variables",  "Micro VC Lead in Seed Binary",           "1 if a micro-VC led the seed round; else 0.",
  "Treatment Variables",  "Corporate VC Lead in Seed Binary",       "1 if a corporate venture arm led the seed round; else 0.",
  "Treatment Variables",  "Target VC Lead in Seed Binary",          "1 if a target VC led the seed round, else 0.",
  "Treatment Variables",  "Years to Seed",                          "Years between founding and first seed round.",
  "Treatment Variables",  "Total Seed Funding (M)",                 "Sum of all seed investments in millions USD.",
  "Control Variables", "Investment Volume in First Seed Year (log)", "Nationwide seed-stage startup funding in a given year to control for the funding environment."
)

lines <- character()

lines <- c(lines, "\\centering")
lines <- c(lines, "{\\footnotesize")           
lines <- c(lines, "\\caption{Variable descriptions.}")
lines <- c(lines, "\\label{tab:var_desc}")
lines <- c(lines, "\\begin{tabular}{p{0.25\\textwidth} p{0.65\\textwidth}}")
lines <- c(lines, "\\toprule")
lines <- c(lines, "Variable & Description \\\\")

current_group <- NULL

for (i in seq_len(nrow(vars))) {
  row <- vars[i, ]
  grp <- row$group

  if (is.null(current_group) || grp != current_group) {
    if (!is.null(current_group)) lines <- c(lines, "\\addlinespace[0.5em]")
    lines <- c(lines,
      "\\midrule",
      sprintf("\\multicolumn{2}{c}{\\tiny\\textsc{%s}} \\\\", toupper(grp)),
      "\\midrule"
    )
    current_group <- grp
  }

  lines <- c(lines,
    sprintf("%s & %s \\\\[0.4em]", row$var, row$desc)
  )
}

lines <- c(lines, "\\bottomrule")
lines <- c(lines, "\\end{tabular}")
lines <- c(lines, "}")                           

# 3. Write out to disk
writeLines(lines, "R-files/tables/table_variable_descriptions.tex")
```


## Company Features Comparison: Overall - Success - No Success

```{r Company Features EDA Success/No Success}
vars <- c(
  "Success",
  "Exit Binary",
  "Funding Success",
  "Number of Founders",
  "Distance to Hub",
  "Hub Binary",
  "B2B Binary",
  "Number Seed Rounds",
  "Avg Seed Investor Distance",
  "Average Seed Investors Portfolio Organizations",
  "Number Seed Investors",
  "Regional Seed Investor Binary",
  "Overregional Seed Investor Binary",
  "Number Lead Seed Investors",
  "Regional Lead Seed Investor Binary",
  "Overregional Lead Seed Investor Binary",
  "Avg Age of Seed Investors",
  "Avg Exits of Seed Investors",
  "Specific VC in Seed Binary",
  "Specific Lead VC in Seed Binary",
  "Target VC in Seed Binary",
  "Target Lead VC in Seed Binary",
  "Accelerator Funding Binary",
  "Angel Group Funding Binary",
  "Micro VC Funding Binary",
  "Corporate Venture Capital Funding Binary",
  "Accelerator Lead Funding Binary",
  "Angel Group Lead Funding Binary",
  "Micro VC Lead Funding Binary",
  "Corporate Venture Capital Lead Funding Binary",
  "Years to Seed",
  "Total Seed Funding (M)",
  "Energy",
  "Materials",
  "Industrials",
  "Consumer Discretionary",
  "Consumer Staples",
  "Health Care",
  "Financials",
  "Information Technology",
  "Communication Services",
  "Utilities",
  "Real Estate",
  "Other",
  "Investment Volume in First Seed Year (log)",
  "Seed Investor Same City",
  "Seed Lead Investor Same City",
  "Homecountry Investor",
  "Homecountry Lead Investor"
)

df_long_full <- companies_seed %>%
  mutate(SuccessGroup = ifelse(Success == 1, "Successful", "Non-successful")) %>%
  select(SuccessGroup, all_of(vars)) %>%
  pivot_longer(-SuccessGroup, names_to="Variable", values_to="Value")


df_long_founders <- companies_seed %>%
  filter(!is.na(`Number of Founders`) & `Number of Founders` > 0) %>%
  mutate(SuccessGroup = ifelse(Success == 1, "Successful", "Non-successful")) %>%
  select(SuccessGroup, `Number of Founders`) %>%
  pivot_longer(-SuccessGroup, names_to="Variable", values_to="Value")

df_long_seed <- companies_seed %>%
  filter(!is.na(`Total Seed Funding (M)`) & `Total Seed Funding (M)` > 0) %>%
  mutate(SuccessGroup = ifelse(Success == 1, "Successful", "Non-successful")) %>%
  select(SuccessGroup, `Total Seed Funding (M)`) %>%
  pivot_longer(-SuccessGroup, names_to="Variable", values_to="Value")

desc_overall_full <- df_long_full %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm=TRUE),
    Overall_SD   = sd(Value,   na.rm=TRUE),
    .groups="drop"
  )

desc_overall_founders <- df_long_founders %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm=TRUE),
    Overall_SD   = sd(Value,   na.rm=TRUE),
    .groups="drop"
  )

desc_overall_seed <- df_long_seed %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm=TRUE),
    Overall_SD   = sd(Value,   na.rm=TRUE),
    .groups="drop"
  )

desc_overall <- desc_overall_full %>%
  rows_update(desc_overall_founders, by="Variable") %>%
  rows_update(desc_overall_seed,     by="Variable")

desc_by_succ_full <- df_long_full %>%
  group_by(Variable, SuccessGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm=TRUE),
    SD   = sd(Value,   na.rm=TRUE),
    .groups="drop"
  ) %>%
  pivot_wider(
    names_from  = SuccessGroup,
    values_from = c(N,Mean,SD),
    names_glue  = "{SuccessGroup}_{.value}"
  )

desc_by_succ_founders <- df_long_founders %>%
  group_by(Variable, SuccessGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm=TRUE),
    SD   = sd(Value,   na.rm=TRUE),
    .groups="drop"
  ) %>%
  pivot_wider(
    names_from  = SuccessGroup,
    values_from = c(N,Mean,SD),
    names_glue  = "{SuccessGroup}_{.value}"
  )

desc_by_succ_seed <- df_long_seed %>%
  group_by(Variable, SuccessGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm=TRUE),
    SD   = sd(Value,   na.rm=TRUE),
    .groups="drop"
  ) %>%
  pivot_wider(
    names_from  = SuccessGroup,
    values_from = c(N,Mean,SD),
    names_glue  = "{SuccessGroup}_{.value}"
  )

desc_by_succ <- desc_by_succ_full %>%
  rows_update(desc_by_succ_founders, by="Variable") %>%
  rows_update(desc_by_succ_seed,     by="Variable")

table3 <- desc_overall %>%
  left_join(desc_by_succ, by="Variable") %>%
  select(
    Variable,
    Overall_N, Overall_Mean, Overall_SD,
    `Non-successful_N`, `Non-successful_Mean`, `Non-successful_SD`,
    `Successful_N`,      `Successful_Mean`,      `Successful_SD`
  ) %>%
  mutate(across(-Variable, ~ round(.x, 2)))

order_vars <- c(
  "Success",
  "Exit Binary",
  "Funding Success",
  "Number of Founders",
  "Distance to Hub",
  "Hub Binary",
  "B2B Binary",
  "Energy",
  "Materials",
  "Industrials",
  "Consumer Discretionary",
  "Consumer Staples",
  "Health Care",
  "Financials",
  "Information Technology",
  "Communication Services",
  "Utilities",
  "Real Estate",
  "Other",
  "Years to Seed",
  "Total Seed Funding (M)",
  "Number Seed Rounds",
  "Avg Seed Investor Distance",
  "Average Seed Investors Portfolio Organizations",
  "Avg Age of Seed Investors",
  "Avg Exits of Seed Investors",
  "Number Seed Investors",
  "Seed Investor Same City",
  "Homecountry Investor",
  "Regional Seed Investor Binary",
  "Overregional Seed Investor Binary",
  "Specific VC in Seed Binary",
  "Accelerator Funding Binary",
  "Angel Group Funding Binary",
  "Micro VC Funding Binary",
  "Corporate Venture Capital Funding Binary",
  "Target VC in Seed Binary",
  "Number Lead Seed Investors",
  "Seed Lead Investor Same City",
  "Homecountry Lead Investor",
  "Regional Lead Seed Investor Binary",
  "Overregional Lead Seed Investor Binary",
  "Specific Lead VC in Seed Binary",
  "Accelerator Lead Funding Binary",
  "Angel Group Lead Funding Binary",
  "Micro VC Lead Funding Binary",
  "Corporate Venture Capital Lead Funding Binary",
  "Target Lead VC in Seed Binary",
  "Investment Volume in First Seed Year (log)"
)

new_labels <- c(
  "Success",
  "Exit",
  "Funding Success",
  "Number of Founders",
  "Distance to Hub",
  "Hub Binary",
  "B2B Binary",
  "Energy",
  "Materials",
  "Industrials",
  "Consumer Discretionary",
  "Consumer Staples",
  "Health Care",
  "Financials",
  "Information Technology",
  "Communication Services",
  "Utilities",
  "Real Estate",
  "Other",
  "Years to Seed",
  "Total Seed Funding (M)",
  "Number Seed Rounds",
  "Avg Seed VC Distance",
  "Avg Seed VC Portfolio Organizations",
  "Avg Age Seed VC",
  "Avg Exits Seed VC",
  "Number Seed VC",
  "Seed VC Same City Binary",
  "Homecountry VC in Seed Binary",
  "Regional Seed VC Binary",
  "Overregional Seed VC Binary",
  "Specific VC in Seed Binary",
  "Accelerator in Seed Binary",
  "Angel Group in Seed Binary",
  "Micro VC in Seed Binary",
  "Corporate VC in Seed Binary",
  "Target VC in Seed Binary",
  "Number Lead Seed VC",
  "Seed Lead VC Same City Binary",
  "Homecountry Lead VC in Seed Binary",
  "Regional Lead VC in Seed Binary",
  "Overregional Lead VC in Seed Binary",
  "Specific Lead VC in Seed Binary",
  "Accelerator Lead in Seed Binary",
  "Angel Group Lead in Seed Binary",
  "Micro VC Lead in Seed Binary",
  "Corporate VC Lead in Seed Binary",
  "Target VC Lead in Seed Binary",
  "Investment Volume in First Seed Year (log)"
)

table3 <- table3 %>%
  mutate(Variable = factor(
    Variable,
    levels = order_vars,
    labels = new_labels
  )) %>%
  arrange(Variable) %>%
  mutate(Variable = as.character(Variable))

tex_table <- kable(
  table3,
  format    = "latex",
  booktabs  = TRUE,
  align     = c("l", rep("r", 9)),
  col.names = c(
    "Variable",
    "N", "Mean", "SD",
    "N", "Mean", "SD",
    "N", "Mean", "SD"
  ),
  caption   = "Descriptive statistics (N, Mean, SD)"
) %>%
  add_header_above(c(
    " "              = 1,
    "Overall"        = 3,
    "Non‐successful" = 3,
    "Successful"     = 3
  )) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

save_kable(tex_table, file = "R-files/tables/table_eda-overall-success-no-success.tex")
```

## Company Description: Overall - B2B  - B2C
```{r B2B vs B2C}
library(dplyr)
library(tidyr)
library(kableExtra)

# define which vars to restrict to >0
vars_positive <- c("Number of Founders", "Total Seed Funding (M)")

# 1) pivot into long form, with your new B2BGroup
df_long_b2b <- companies_seed %>%
  mutate(
    B2BGroup = ifelse(`B2B Binary` == 1, "B2B", "B2C")
  ) %>%
  select(B2BGroup, all_of(vars)) %>%
  pivot_longer(-B2BGroup, names_to = "Variable", values_to = "Value") %>%
  # for Number of Founders and Total Seed Funding, turn any ≤ 0 into NA
  mutate(
    Value = case_when(
      Variable == "Number of Founders"     & Value <=  0 ~ NA_real_,
      Variable == "Total Seed Funding (M)" & Value <=  0 ~ NA_real_,
      TRUE                                       ~ Value
    )
  )

# 2) overall summaries
desc_overall <- df_long_b2b %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm = TRUE),
    Overall_SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  )

# 3) by‐group summaries (B2B vs B2C)
desc_by_b2b <- df_long_b2b %>%
  group_by(Variable, B2BGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm = TRUE),
    SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_wider(
    names_from  = B2BGroup,
    values_from = c(N, Mean, SD),
    names_glue  = "{B2BGroup}_{.value}"
  )

# 4) join into final table
table3_b2b <- desc_overall %>%
  left_join(desc_by_b2b, by = "Variable") %>%
  select(
    Variable,
    Overall_N,    Overall_Mean,    Overall_SD,
    B2B_N,        B2B_Mean,        B2B_SD,
    B2C_N,        B2C_Mean,        B2C_SD
  ) %>%
  mutate(across(-Variable, ~ round(.x, 2)))

# 5) apply ordering & relabeling
table3_b2b <- table3_b2b %>%
  mutate(Variable = factor(
    Variable,
    levels = order_vars,
    labels = new_labels
  )) %>%
  arrange(Variable) %>%
  mutate(Variable = as.character(Variable))

# 6) kableExtra pipeline
tex_table_b2b <- table3_b2b %>%
  kable(
    format    = "latex",
    booktabs  = TRUE,
    align     = c("l", rep("r", 9)),
    col.names = c(
      "Variable",
      "N", "Mean", "SD",
      "N", "Mean", "SD",
      "N", "Mean", "SD"
    ),
    caption   = "Descriptive statistics (N, Mean, SD)",
    escape    = FALSE
  ) %>%
  add_header_above(c(
    " "       = 1,
    "Overall" = 3,
    "B2B"     = 3,
    "B2C"     = 3
  ), escape = FALSE) %>%
  kable_styling(
    position      = "center",
    latex_options = c("hold_position", "scale_down"),
    font_size     = 7
  )

# 7) wrap in footnotesize + centering and save
full_tex_b2b <- paste0(
  "{\\footnotesize\n",
  "\\centering\n",
  tex_table_b2b,
  "\n}\n"
)
cat(full_tex_b2b, file = "R-files/tables/table_eda-overall-b2b-b2c.tex")
```

## Company Description: Hub vs No Hub
```{r Hub vs No Hub}
library(dplyr)
library(tidyr)
library(kableExtra)

# define which vars to restrict to >0
vars_positive <- c("Number of Founders", "Total Seed Funding (M)")

# 1) pivot into long form, with your new HubGroup
df_long_hub <- companies_seed %>%
  mutate(
    HubGroup = ifelse(`Hub Binary` == 1, "Hub", "No‐Hub")
  ) %>%
  select(HubGroup, all_of(vars)) %>%
  pivot_longer(-HubGroup, names_to = "Variable", values_to = "Value") %>%
  # for Number of Founders and Total Seed Funding, turn any ≤ 0 into NA
  mutate(
    Value = case_when(
      Variable == "Number of Founders"     & Value <=  0 ~ NA_real_,
      Variable == "Total Seed Funding (M)" & Value <=  0 ~ NA_real_,
      TRUE                                       ~ Value
    )
  )

# 2) overall summaries
desc_overall <- df_long_hub %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm = TRUE),
    Overall_SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  )

# 3) by‐group summaries (Hub vs No‐Hub)
desc_by_hub <- df_long_hub %>%
  group_by(Variable, HubGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm = TRUE),
    SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_wider(
    names_from  = HubGroup,
    values_from = c(N, Mean, SD),
    names_glue  = "{HubGroup}_{.value}"
  )

# 4) join into final table
table3_hub <- desc_overall %>%
  left_join(desc_by_hub, by = "Variable") %>%
  select(
    Variable,
    Overall_N,    Overall_Mean,    Overall_SD,
    Hub_N,        Hub_Mean,        Hub_SD,
    `No‐Hub_N`,   `No‐Hub_Mean`,   `No‐Hub_SD`
  ) %>%
  mutate(across(-Variable, ~ round(.x, 2)))

# 5) apply ordering & relabeling
table3_hub <- table3_hub %>%
  mutate(Variable = factor(
    Variable,
    levels = order_vars,
    labels = new_labels
  )) %>%
  arrange(Variable) %>%
  mutate(Variable = as.character(Variable))

# 6) kableExtra pipeline
tex_table_hub <- table3_hub %>%
  kable(
    format    = "latex",
    booktabs  = TRUE,
    align     = c("l", rep("r", 9)),
    col.names = c(
      "Variable",
      "N", "Mean", "SD",
      "N", "Mean", "SD",
      "N", "Mean", "SD"
    ),
    caption   = "Descriptive statistics (N, Mean, SD)",
    escape    = FALSE
  ) %>%
  add_header_above(c(
    " "      = 1,
    "Overall" = 3,
    "Hub"     = 3,
    "No‐Hub"  = 3
  ), escape = FALSE) %>%
  kable_styling(
    position      = "center",
    latex_options = c("hold_position", "scale_down"),
    font_size     = 7
  )

# 7) wrap in footnotesize + centering and save
full_tex_hub <- paste0(
  "{\\footnotesize\n",
  "\\centering\n",
  tex_table_hub,
  "\n}\n"
)
cat(full_tex_hub, file = "R-files/tables/table_eda-overall-hub-nohub.tex")
```

## Company Description: Target VC vs No Target VC
```{r}
library(dplyr)
library(tidyr)
library(kableExtra)

# define which vars to restrict to >0
vars_positive <- c("Number of Founders", "Total Seed Funding (M)")

# 1) pivot into long form, with your new TargetVCGroup
df_long_tvc <- companies_seed %>%
  mutate(
    TargetVCGroup = ifelse(`Target VC in Seed Binary` == 1,
                           "Target VC", "No Target VC")
  ) %>%
  select(TargetVCGroup, all_of(vars)) %>%
  pivot_longer(-TargetVCGroup, names_to = "Variable", values_to = "Value") %>%
  # for Number of Founders and Total Seed Funding, turn any ≤0 into NA
  mutate(
    Value = case_when(
      Variable == "Number of Founders"       & Value <=  0 ~ NA_real_,
      Variable == "Total Seed Funding (M)"   & Value <=  0 ~ NA_real_,
      TRUE                                          ~ Value
    )
  )

# 2) overall summaries
desc_overall <- df_long_tvc %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm = TRUE),
    Overall_SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  )

# 3) by‐group summaries (Target VC vs No Target VC)
desc_by_tvc <- df_long_tvc %>%
  group_by(Variable, TargetVCGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm = TRUE),
    SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_wider(
    names_from  = TargetVCGroup,
    values_from = c(N, Mean, SD),
    names_glue  = "{TargetVCGroup}_{.value}"
  )

# 4) join into final table
table3_tvc <- desc_overall %>%
  left_join(desc_by_tvc, by = "Variable") %>%
  select(
    Variable,
    Overall_N,        Overall_Mean,        Overall_SD,
    `Target VC_N`,    `Target VC_Mean`,    `Target VC_SD`,
    `No Target VC_N`, `No Target VC_Mean`, `No Target VC_SD`
  ) %>%
  mutate(across(-Variable, ~ round(.x, 2)))

# 5) apply ordering & relabeling
table3_tvc <- table3_tvc %>%
  mutate(Variable = factor(
    Variable,
    levels = order_vars,
    labels = new_labels
  )) %>%
  arrange(Variable) %>%
  mutate(Variable = as.character(Variable))

# 6) kableExtra pipeline
tex_table_tvc <- table3_tvc %>%
  kable(
    format    = "latex",
    booktabs  = TRUE,
    align     = c("l", rep("r", 9)),
    col.names = c(
      "Variable",
      "N", "Mean", "SD",
      "N", "Mean", "SD",
      "N", "Mean", "SD"
    ),
    caption   = "Descriptive statistics (N, Mean, SD)",
    escape    = FALSE
  ) %>%
  add_header_above(c(
    " "            = 1,
    "Overall"      = 3,
    "Target VC"    = 3,
    "No Target VC" = 3
  ), escape = FALSE) %>%
  kable_styling(
    position      = "center",
    latex_options = c("hold_position", "scale_down"),
    font_size     = 7
  )

# 7) wrap in footnotesize + centering and save
full_tex_tvc <- paste0(
  "{\\footnotesize\n",
  "\\centering\n",
  tex_table_tvc,
  "\n}\n"
)
cat(full_tex_tvc, file = "R-files/tables/table_eda-overall-targetvc-notargetvc.tex")
```

## Sector Distribution
```{r Sector Distribution}
sector_cols <- c(
  "Information Technology",
  "Communication Services",
  "Industrials",
  "Consumer Discretionary",
  "Health Care",
  "Consumer Staples",
  "Financials",
  "Real Estate",
  "Utilities",
  "Energy",
  "Materials",
  "Other"
)

N_total <- nrow(companies_seed)

table5 <- tibble(Business_sector = sector_cols) %>%
  rowwise() %>%
  mutate(
    Relative_freq = sum(companies_seed[[Business_sector]], na.rm=TRUE) / N_total * 100,
    Success_rate  = if (sum(companies_seed[[Business_sector]], na.rm=TRUE) > 0) {
      sum(companies_seed$Success * companies_seed[[Business_sector]], na.rm=TRUE) /
        sum(companies_seed[[Business_sector]], na.rm=TRUE) * 100
    } else {
      NA_real_
    }
  ) %>%
  ungroup() %>%
  arrange(desc(Relative_freq)) %>%
  mutate(
    Relative_freq = round(Relative_freq, 2),
    Success_rate  = round(Success_rate, 2)
  )

table5 %>%
  kable(
    format    = "latex",
    booktabs  = TRUE,
    align     = c("l", "r", "r"),
    col.names = c(
      "Business sector",
      "Relative freq. (in \\%)",
      "Success rate (in \\%)"
    ),
    caption   = "Relative frequencies and success rates of startups across different business sectors.",
    label     = "tab:table5"
  ) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

latex_table <- table5 %>%
  kable(
    format    = "latex",
    booktabs  = TRUE,
    align     = c("l", "r", "r"),
    col.names = c(
      "Business sector",
      "Relative freq. (in \\%)",
      "Success rate (in \\%)"
    ),
    caption   = "Relative frequencies and success rates of startups across different business sectors.",
    label     = "tab:table5"
  ) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

print(latex_table)

setwd("~/Projects/Master-Thesis-Spatial-Proximity-Venture-Capital")
save_kable(latex_table, file = "R-files/tables/table_sector-distribution.tex")
```

```{r Hub vs No Hub (Germany, SeedFunding>0)}
library(dplyr)
library(tidyr)
library(kableExtra)

# 0) filter to German HQs
companies_de_gt0 <- companies_seed %>%
  filter(`Headquarters Country` == "Germany")

# 1) pivot into long form and zero‐filter only those two vars
vars_positive <- c("Number of Founders", "Total Seed Funding (M)")

df_long_hub_de <- companies_de_gt0 %>%
  mutate(HubGroup = ifelse(`Hub Binary` == 1, "Hub", "No‐Hub")) %>%
  select(HubGroup, all_of(vars)) %>%
  pivot_longer(-HubGroup, names_to = "Variable", values_to = "Value") %>%
  # for the two positive‐only vars, turn ≤0 into NA
  mutate(
    Value = case_when(
      Variable == "Number of Founders"     & Value <=  0 ~ NA_real_,
      Variable == "Total Seed Funding (M)" & Value <=  0 ~ NA_real_,
      TRUE                                         ~ Value
    )
  )

# 2) overall summaries
desc_overall_de <- df_long_hub_de %>%
  group_by(Variable) %>%
  summarise(
    Overall_N    = sum(!is.na(Value)),
    Overall_Mean = mean(Value, na.rm = TRUE),
    Overall_SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  )

# 3) by‐group summaries (Hub vs No‐Hub)
desc_by_hub_de <- df_long_hub_de %>%
  group_by(Variable, HubGroup) %>%
  summarise(
    N    = sum(!is.na(Value)),
    Mean = mean(Value, na.rm = TRUE),
    SD   = sd(Value,   na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_wider(
    names_from  = HubGroup,
    values_from = c(N, Mean, SD),
    names_glue  = "{HubGroup}_{.value}"
  )

# 4) join into final table
table3_hub_de <- desc_overall_de %>%
  left_join(desc_by_hub_de, by = "Variable") %>%
  select(
    Variable,
    Overall_N,    Overall_Mean,    Overall_SD,
    Hub_N,        Hub_Mean,        Hub_SD,
    `No‐Hub_N`,   `No‐Hub_Mean`,   `No‐Hub_SD`
  ) %>%
  mutate(across(-Variable, ~ round(.x, 2)))

# 5) apply your ordering & relabeling
table3_hub_de <- table3_hub_de %>%
  mutate(Variable = factor(
    Variable,
    levels = order_vars,
    labels = new_labels
  )) %>%
  arrange(Variable) %>%
  mutate(Variable = as.character(Variable))

# 6) kableExtra pipeline
tex_table_hub_de <- table3_hub_de %>%
  kable(
    format    = "latex",
    booktabs  = TRUE,
    align     = c("l", rep("r", 9)),
    col.names = c(
      "Variable",
      "N", "Mean", "SD",
      "N", "Mean", "SD",
      "N", "Mean", "SD"
    ),
    caption   = "Descriptive statistics for German HQs with Seed Funding > 0 (N, Mean, SD)",
    escape    = FALSE
  ) %>%
  add_header_above(c(
    " "       = 1,
    "Overall" = 3,
    "Hub"     = 3,
    "No‐Hub"  = 3
  ), escape = FALSE) %>%
  kable_styling(
    position      = "center",
    latex_options = c("hold_position", "scale_down"),
    font_size     = 7
  )

# 7) wrap in footnotesize + centering and save
full_tex_hub_de <- paste0(
  "{\\footnotesize\n",
  "\\centering\n",
  tex_table_hub_de,
  "\n}\n"
)
cat(full_tex_hub_de, file = "R-files/tables/table_eda-overall-hub-nohub-germany-seedfunding.tex")
```

